{{ config(materialized='table') }}

select
POS,
Name,
ORG,
B,
T,
OVR,
STU,
MOV,
CON,
PBABIP,
HRR,
`STU_vL`,
`MOV_vL`,
`CON_vL`,
`PBABIP_vL`,
`HRR_vL`,
`STU_vR`,
`MOV_vR`,
`CON_vR`,
`PBABIP_vR`,
`HRR_vR`,
FB,
CH,
CB,
SL,
SI,
SP,
CT,
FO,
CC,
SC,
KC,
KN,
PIT,
`G/F`,
VELO,
Slot,
PT,
STM,
HLD,
`IF_RNG`,
`IF_ERR`,
`IF_ARM`,
SUM(P*IP)/NULLIF(SUM(IP*IP),0)*9 as P,
SUM(G*IP)/NULLIF(SUM(IP*IP),0)*9 as G,
SUM(GS*IP)/NULLIF(SUM(IP*IP),0)*9 as GS,
SUM(W*IP)/NULLIF(SUM(IP*IP),0)*9 as W,
SUM(L*IP)/NULLIF(SUM(IP*IP),0)*9 as L,
SUM(`WIN_perc`*IP)/NULLIF(SUM(IP),0) as `WIN_perc`,
SUM(SVO*IP)/NULLIF(SUM(IP*IP),0)*9 as SVO,
SUM(SV*IP)/NULLIF(SUM(IP*IP),0)*9 as SV,
SUM(`SV_perc`*IP)/NULLIF(SUM(IP),0) as `SV_perc`,
SUM(BS*IP)/NULLIF(SUM(IP*IP),0)*9 as BS,
SUM(`BS_perc`*IP)/NULLIF(SUM(IP),0) as `BS_perc`,
SUM(`HLD_other`*IP)/NULLIF(SUM(IP*IP),0)*9 as `HLD_other`,
SUM(SD*IP)/NULLIF(SUM(IP*IP),0)*9 as SD,
SUM(MD*IP)/NULLIF(SUM(IP*IP),0)*9 as MD,
SUM(IP) as IP,
SUM(BF*IP)/NULLIF(SUM(IP*IP),0)*9 as BF, -- e.g. Σ (20 BF * 9 IP , 10BF * 6 IP) / Σ (9*9, 6*6) * 9 => 240 / 117 * 9 = 18,461
SUM(AB*IP)/NULLIF(SUM(IP*IP),0)*9 as AB,
SUM(HA*IP)/NULLIF(SUM(IP*IP),0)*9 as HA,
SUM(`1B`*IP)/NULLIF(SUM(IP*IP),0)*9 as `1B`,
SUM(`2B`*IP)/NULLIF(SUM(IP*IP),0)*9 as `2B`,
SUM(`3B`*IP)/NULLIF(SUM(IP*IP),0)*9 as `3B`,
SUM(HR*IP)/NULLIF(SUM(IP*IP),0)*9 as HR,
SUM(TB*IP)/NULLIF(SUM(IP*IP),0)*9 as TB,
SUM(R*IP)/NULLIF(SUM(IP*IP),0)*9 as R,
SUM(ER*IP)/NULLIF(SUM(IP*IP),0)*9 as ER, -- basically ERA as it is per 9 innings
SUM(BB*IP)/NULLIF(SUM(IP*IP),0)*9 as BB,
SUM(IBB*IP)/NULLIF(SUM(IP*IP),0)*9 as IBB,
SUM(K*IP)/NULLIF(SUM(IP*IP),0)*9 as K,
SUM(HP*IP)/NULLIF(SUM(IP*IP),0)*9 as HP,
--SUM(ERA*IP)/NULLIF(SUM(IP),0) as ERA,
SUM(`AVG`*IP)/NULLIF(SUM(IP),0) as `AVG`,
SUM(OBP*IP)/NULLIF(SUM(IP),0) as OBP,
SUM(SLG*IP)/NULLIF(SUM(IP),0) as SLG,
SUM(OPS*IP)/NULLIF(SUM(IP),0) as OPS,
SUM(BABIP*IP)/NULLIF(SUM(IP),0) as BABIP,
SUM(WHIP*IP)/NULLIF(SUM(IP),0) as WHIP,
--SUM(`RA/9`*IP)/NULLIF(SUM(IP),0) as `RA/9`,
--SUM(`HR/9`*IP)/NULLIF(SUM(IP),0) as `HR/9`,
--SUM(`H/9`*IP)/NULLIF(SUM(IP),0) as `H/9`,
--SUM(`BB/9`*IP)/NULLIF(SUM(IP),0) as `BB/9`,
--SUM(`K/9`*IP)/NULLIF(SUM(IP),0) as `K/9`,
SUM(`K/BB`*IP)/NULLIF(SUM(IP),0) as `K/BB`,
SUM(`K_perc`*IP)/NULLIF(SUM(IP),0) as `K_perc`,
SUM(`BB_perc`*IP)/NULLIF(SUM(IP),0) as `BB_perc`,
SUM(`K_BB_perc`*IP)/NULLIF(SUM(IP),0) as `K_BB_perc`,
SUM(SH*IP)/NULLIF(SUM(IP*IP),0)*9 as SH,
SUM(SF*IP)/NULLIF(SUM(IP*IP),0)*9 as SF,
SUM(WP*IP)/NULLIF(SUM(IP*IP),0)*9 as WP,
SUM(BK*IP)/NULLIF(SUM(IP*IP),0)*9 as BK,
SUM(CI*IP)/NULLIF(SUM(IP*IP),0)*9 as CI,
SUM(DP*IP)/NULLIF(SUM(IP*IP),0)*9 as DP,
SUM(RA*IP)/NULLIF(SUM(IP*IP),0)*9 as RA,
SUM(GF*IP)/NULLIF(SUM(IP*IP),0)*9 as GF,
SUM(IR*IP)/NULLIF(SUM(IP*IP),0)*9 as IR,
SUM(IRS*IP)/NULLIF(SUM(IP*IP),0)*9 as IRS,
SUM(`IRS_perc`*IP)/NULLIF(SUM(IP),0) as `IRS_perc`,
SUM(`LOB_perc`*IP)/NULLIF(SUM(IP),0) as `LOB_perc`,
SUM(pLi*IP)/NULLIF(SUM(IP*IP),0)*9 as pLi,
SUM(`GF_perc`*IP)/NULLIF(SUM(IP),0) as `GF_perc`,
SUM(QS*IP)/NULLIF(SUM(IP*IP),0)*9 as QS,
SUM(`QS_perc`*IP)/NULLIF(SUM(IP),0) as `QS_perc`,
SUM(CG*IP)/NULLIF(SUM(IP*IP),0)*9 as CG,
SUM(`CG_perc`*IP)/NULLIF(SUM(IP),0) as `CG_perc`,
SUM(SHO*IP)/NULLIF(SUM(IP*IP),0)*9 as SHO,
SUM(PPG*IP)/NULLIF(SUM(IP*IP),0)*9 as PPG,
SUM(RS*IP)/NULLIF(SUM(IP*IP),0)*9 as RS,
SUM(RSG*IP)/NULLIF(SUM(IP*IP),0)*9 as RSG,
SUM(`PI`*IP)/NULLIF(SUM(IP*IP),0)*9 as `PI`,
SUM(GB*IP)/NULLIF(SUM(IP*IP),0)*9 as GB,
SUM(`FB_other`*IP)/NULLIF(SUM(IP*IP),0)*9 as `FB_other`,
SUM(`GO_perc`*IP)/NULLIF(SUM(IP),0) as `GO_perc`,
SUM(SB*IP)/NULLIF(SUM(IP*IP),0)*9 as SB,
SUM(CS*IP)/NULLIF(SUM(IP*IP),0)*9 as CS,
SUM(`ERA+`*IP)/NULLIF(SUM(IP),0) as `ERA+`,
SUM(FIP*IP)/NULLIF(SUM(IP),0) as FIP,
SUM(`FIP-`*IP)/NULLIF(SUM(IP),0) as `FIP-`,
SUM(WPA*IP)/NULLIF(SUM(IP),0) as WPA,
SUM(WAR*IP)/NULLIF(SUM(IP*IP),0)*9 as WAR,
SUM(rWAR*IP)/NULLIF(SUM(IP*IP),0)*9 as rWAR,
SUM(SIERA*IP)/NULLIF(SUM(IP),0) as SIERA,
SUM(TC*IP)/NULLIF(SUM(IP*IP),0)*9 as TC,
SUM(A*IP)/NULLIF(SUM(IP*IP),0)*9 as A,
SUM(PO*IP)/NULLIF(SUM(IP*IP),0)*9 as PO,
SUM(E*IP)/NULLIF(SUM(IP*IP),0)*9 as E,
SUM(`DP_other`*IP)/NULLIF(SUM(IP*IP),0)*9 as `DP_other`,
SUM(TP*IP)/NULLIF(SUM(IP*IP),0)*9 as TP,
SUM(PCT*IP)/NULLIF(SUM(IP),0) as PCT,
SUM(RNG*IP)/NULLIF(SUM(IP),0) as RNG,
SUM(ZR*IP)/NULLIF(SUM(IP*IP),0)*9 as ZR,
SUM(EFF*IP)/NULLIF(SUM(IP),0) as EFF
from {{ ref('stg_pitchers_types') }}
group by 
POS, 
Name, 
ORG, 
B, 
T, 
OVR, 
STU,
MOV, 
CON, 
PBABIP, 
HRR, 
`STU_vL`, 
`MOV_vL`,
`CON_vL`, 
`PBABIP_vL`, 
`HRR_vL`, 
`STU_vR`, 
`MOV_vR`,
`CON_vR`, 
`PBABIP_vR`, 
`HRR_vR`, 
FB, 
CH, 
CB,
SL, 
SI, 
SP, 
CT, 
FO, 
CC,
SC, 
KC, 
KN, 
PIT, 
`G/F`, 
VELO,
Slot, 
PT, 
STM, 
HLD, 
`IF_RNG`, 
`IF_ERR`,
`IF_ARM`